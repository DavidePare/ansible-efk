Role Name
=========

Elasticsearch Role

Requirements
------------

Install Java openjdk-11-jdk. 

Role Variables
--------------

---

cluster_name: Name of the cluster it should be the same for each host. 

path_logs: Very important route to check the connection between the nodes and whether the installation was successful

network_host: Network that can reach this host; usually 0.0.0.0 if defined credentials to each user to access the cluster
http_port: Port to make the request to the elastic cluster. Example http://localhost:9200/_cluster/health

Download elasticsearch version, GPG-Key and local directories

elastic_psk_url:  https://artifacts.elastic.co/GPG-KEY-elasticsearch

elastic_repo: https://artifacts.elastic.co/packages/8.x/apt

elasticsearch_url: https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.8.2-amd64.deb

elasticsearch_extract_dir: /etc/elasticsearch

elasticsearch_default_path: /etc/default/elasticsearch

elasticsearch_file_dpkg: elasticsearch-8.8.2-amd64.deb

elasticsearch_version: 8.8.2

---- More info of certicates: https://www.elastic.co/guide/en/elasticsearch/reference/current/certutil.html

elasticsearch_certs_dir: Path to install certificates

elasticsearch_certificates: File which holds the CA certificate and the private key for the CA. Geneaterd with elasticsearch-certutil cert --ca

elastic_certificates_password: Password for the certificate


home_path: /usr/share/elasticsearch

executable_path: Path where are the plugins for Elasticsearch (generate certificate)


ca_certificate_name: Generated by elasticsearch-certutil ca

ca_certificate_password: Password certicate

bootstrap_pass: This password permits to log in the kibana dashboard with the user elastic. It is also the password that will be used for the keystore


elasticsearch_http_password: changepasswordhttp

http_file_security: Name of the http certificate for Kibana (http.p12)

elasticsearch_ca_pem: Elasticsearch Pem key used for kibana

elasticsearch_https_enabled: Enable HTTPS

elasticsearch_security_enabled: Activate xpack security 

elasticsearch_data_dir: /elasticsearch/data

elasticsearch_log_dir: /var/log/elasticsearch

elasticsearch_pid_dir: /var/run/elasticsearch

elasticsearch_conf_dir: /etc/elasticsearch

xpack_security_enabled: true

xpack_security_enrollment_enabled: true

es_home: /usr/share/elasticsearch

es_conf_dir: /etc/elasticsearch


es_mode: 0660

es_api_protocol: "https"

es_api_host: "localhost"

es_api_port: 9200


es_validate_certs: no

es_force_basic_auth: yes


elasticsearch_users: All the users where you want to changre password otherwise they will be randomly generated for default

### Fluentd Users data
fluentd_user: fluentd
fluentd_password: passwordfluentd
fluentd_role: fluentd_permissions taken from the file roles.yml in template



Dependencies
------------

roles/java11

Example Playbook
----------------

Example, the elasticsearch_ca will generate the certificates

- hosts: elasticsearch_ca,nodes 
  become: true
  roles: 
    - ../roles/java11
    - ../roles/elasticsearch

License
-------

BSD

Author Information
------------------

Some tasks take in inspiration from https://garutilorenzo.github.io/ansible-collection-elk/
All the tasks step by step can be find in the official documentation https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html